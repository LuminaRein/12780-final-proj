<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Clickable Hex Grid</title>
  <style>
    :root { color-scheme: light; }
    body { font-family: system-ui, Arial, sans-serif; margin: 0; padding: 24px; background:#0b1020; color:#e8ecff; }
    .wrap { display: grid; gap: 14px; max-width: 1100px; margin: 0 auto; }
    .bar { display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; }
    #msg { padding: 10px 12px; border-radius: 10px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.14); }
    .card { border-radius: 16px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); padding: 14px; overflow: hidden; }
    svg { width: 100%; height: auto; display:block; }

    .hex {
      cursor: pointer;
      transition: transform 120ms ease, filter 120ms ease, opacity 120ms ease;
      stroke: rgba(255,255,255,0.35);
      stroke-width: 1.2;
    }
    .hex:hover { filter: brightness(1.12); }
    .hex:active { transform: scale(0.985); }

    .label {
      pointer-events: none;
      font-size: 13px;
      font-weight: 700;
      fill: rgba(10,14,30,0.9);
    }
    .small {
      pointer-events: none;
      font-size: 11px;
      font-weight: 800;
      fill: rgba(10,14,30,0.7);
    }
    .centerLabel {
      pointer-events: none;
      font-size: 18px;
      font-weight: 900;
      fill: rgba(10,14,30,0.85);
    }
    .legend text { fill: rgba(232,236,255,0.9); font-size: 12px; font-weight: 700; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <div><strong>Clickable Hex Grid</strong> (SVG)</div>
      <div id="msg">Click any hexagon → <strong>clicked</strong></div>
    </div>

    <div class="card">
      <svg id="svg" viewBox="0 0 980 720" role="img" aria-label="Clickable hex grid"></svg>
    </div>
  </div>

  <script>  
    const SQRT3 = Math.sqrt(3);

    function axialToPixel(q, r, size) {
      const x = size * SQRT3 * (q + r/2);
      const y = size * 1.5 * r;
      return { x, y };
    }

    function hexPoints(cx, cy, size) {
      // flat-top hex canvas
      const pts = [];
      for (let i = 0; i < 6; i++) {
        const angle = (Math.PI / 180) * (60 * i - 30);
        const x = cx + size * Math.cos(angle);
        const y = cy + size * Math.sin(angle);
        pts.push(`${x.toFixed(2)},${y.toFixed(2)}`);
      }
      return pts.join(" ");
    }
    
    // axial dir
    function cubeFromAxial(q, r) {
      const x = q;
      const z = r;
      const y = -x - z;
      return { x, y, z };
    }

    const RADIUS = 3;
    const SIZE = 54;

    const palette = [
      "#3dd6d0", "#ffcc66", "#bca7ff", "#ff7aa2",
      "#7fe37d", "#6aa7ff", "#ffa36a", "#ffd6f6"
    ];
    
    // random color
    function colorFor(q, r) {
      const k = Math.abs(q*7 + r*11) % palette.length;
      return palette[k];
    }

    const svg = document.getElementById("svg");
    const msg = document.getElementById("msg");

    const origin = { x: 490, y: 345 };

    // instantiate hexes
    const hexes = [];
    for (let q = -RADIUS; q <= RADIUS; q++) {
      for (let r = -RADIUS; r <= RADIUS; r++) {
        const s = -q - r;
        if (Math.max(Math.abs(q), Math.abs(r), Math.abs(s)) <= RADIUS) {
          hexes.push({ q, r, s });
        }
      }
    }
    hexes.sort((a,b) => (a.r - b.r) || (a.q - b.q));

    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
    svg.appendChild(g);

    hexes.forEach(({q,r,s}) => {
      const p = axialToPixel(q, r, SIZE);
      const cx = origin.x + p.x;
      const cy = origin.y + p.y;

      const poly = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
      poly.setAttribute("points", hexPoints(cx, cy, SIZE));
      poly.setAttribute("class", "hex");
      poly.setAttribute("fill", (q === 0 && r === 0) ? "#ffe36e" : colorFor(q,r));
      poly.setAttribute("opacity", (q === 0 && r === 0) ? "0.95" : "0.78");
      poly.dataset.q = q;
      poly.dataset.r = r;
      poly.dataset.s = s;

      poly.addEventListener("click", (e) => {
        const Q = e.currentTarget.dataset.q;
        const R = e.currentTarget.dataset.r;
        const S = e.currentTarget.dataset.s;
        msg.innerHTML = `clicked <strong>(q=${Q}, r=${R}, s=${S})</strong>`;
      });

      g.appendChild(poly);

      if (q === 0 && r === 0) {
        const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
        t.setAttribute("x", cx);
        t.setAttribute("y", cy + 6);
        t.setAttribute("text-anchor", "middle");
        t.setAttribute("class", "centerLabel");
        t.textContent = "q r s";
        g.appendChild(t);
      } else {
        const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
        t.setAttribute("x", cx);
        t.setAttribute("y", cy + 4);
        t.setAttribute("text-anchor", "middle");
        t.setAttribute("class", "label");
        t.textContent = `${q},${r},${s}`;
        g.appendChild(t);

        const t2 = document.createElementNS("http://www.w3.org/2000/svg", "text");
        t2.setAttribute("x", cx + SIZE * 0.40);
        t2.setAttribute("y", cy - SIZE * 0.30);
        t2.setAttribute("text-anchor", "middle");
        t2.setAttribute("class", "small");
        t2.textContent = (Math.abs(q)+Math.abs(r)+Math.abs(s)) % 4; // 0..3
        g.appendChild(t2);
      }
    });

    const legend = document.createElementNS("http://www.w3.org/2000/svg", "g");
    legend.setAttribute("class", "legend");
    svg.appendChild(legend);

    function addLegend(x,y,text) {
      const t = document.createElementNS("http://www.w3.org/2000/svg", "text");
      t.setAttribute("x", x);
      t.setAttribute("y", y);
      t.textContent = text;
      legend.appendChild(t);
    }
    addLegend(18, 30, "Tip: click any hex → message shows “clicked” + (q,r,s)");
  </script>
</body>
</html>
